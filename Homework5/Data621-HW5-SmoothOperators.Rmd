---
title: "DATA621-HW5-SmoothOperators"
author: "Rob Hodde, Matt Farris, Jeffrey Burmood, Bin Lin"
date: "5/11/2017"
output: pdf_document
---

###Problem Description  
  
Explore, analyze and model a data set containing information on approximately 12,000 commercially available wines. The variables are mostly related to the chemical properties of the wine being sold. The response variable is the number of sample cases of wine that were purchased by wine distribution companies after sampling a wine. These cases would be used to provide tasting samples to restaurants and wine stores around the United States. The more sample cases purchased, the more likely is a wine to be sold at a high end restaurant. A large wine manufacturer is studying the data in order to predict the number of wine cases ordered based upon the wine characteristics. If the wine manufacturer can predict the number of cases, then that manufacturer will be able to adjust their wine offering to maximize sales.  
  
The objective is to build a count regression model to predict the number of cases of wine that will be sold given certain properties of the wine.  
  

\begin{center}
{\huge Data Exploration}
\end{center}

---

##Data Exploration

```{r,echo=FALSE}
# Load required libraries
suppressWarnings(suppressMessages(library(ggplot2)))
suppressWarnings(suppressMessages(library(ROCR)))
suppressWarnings(suppressMessages(library(RCurl)))
suppressWarnings(suppressMessages(library(knitr)))
suppressWarnings(suppressMessages(library(Hmisc)))
suppressWarnings(suppressMessages(library(caret)))
suppressWarnings(suppressMessages(library(stringr)))
suppressWarnings(suppressMessages(library(mice)))
suppressWarnings(suppressMessages(library(dplyr)))
suppressWarnings(suppressMessages(library(reshape2)))
suppressWarnings(suppressMessages(library(MASS)))
suppressWarnings(suppressMessages(library(pscl)))
#
# Read in the dataset from github
wine.raw <- read.csv(text=getURL("https://raw.githubusercontent.com/jeffreyburmood/data621/master/Homework5/wine-training-data.csv"),header=TRUE,na.strings=c(""," "), stringsAsFactors = FALSE)
wine_eval <- read.csv(text=getURL("https://raw.githubusercontent.com/jeffreyburmood/data621/master/Homework4/wine-evaluation-data.csv"),header=TRUE,na.strings=c(""," "), stringsAsFactors = FALSE)
# 

# get rid of the INDEX column since it's not used
wine <- wine.raw[2:length(wine.raw)]

# Let's start by exploring the type of each variable
types <- sapply(1:length(wine),function(x) typeof(wine[,x]))
types.df <- data.frame(VAR=names(wine),TYPE=types)
kable(types.df)

# Now generate some summary statistics
kable(summary(wine[1:6]))
kable(summary(wine[7:12]))
kable(summary(wine[13:length(wine)]))
#

```
  
NEED VERBIAGE - DATA EXPLORATION: There are numerous NAs in certain variables, and variables with negative values. Variables with negative values have apparently normal distributions so it's possible some previous data adjustments have been made. The variable data with negative values in stable, normal distributions will be used as-is.

NEED TO EXPLORE MEAN AND VARIANCE OF OUTCOME VARIABLE. POISSON PROBABLITY MASS FUNCTION

NEED TARGET COUNT HISTOGRAM, NOT ORGANIZED BY STARS.
  
Clean data by removing unnecessary columns, replacing NA's, and setting the unrated wines (no stars) to zero stars, so they can be analyzed.  
  

```{r}
ggplot(wine, aes(TARGET, fill = STARS)) + geom_bar(stat = "count") + facet_grid(STARS ~ 
    ., margins = TRUE, scales = "free")

```

\begin{center}
{\huge Data Preparation}
\end{center}


##Data Preparation  

  
```{r,echo=FALSE}

#
# replace missing STARS values with zero's.  (like saying "Not Rated")
wine$STARS[is.na(wine$STARS)] <- 0 

# Use MICE package to fill in NA's - uses Predictive Mean Matching to fill in NA's 
wine.i <- mice(wine, m = 3, print=F)
wine <- complete(wine.i,1)# Next, get a general look at the data

f <- colnames(wine)  # establish the data categories to be studied
v <- length(f)

#generate boxplots so we can visualize the level of normality of each variable
par(mfcol=c(1,3))
for (i in 1:v){boxplot(wine[,i],main = f[i])}

# DO WE STILL NEED THIS IF WE DON:T CHANGE TO FACTORS???
#wine$TARGET <- as.numeric(as.character(wine$TARGET))

# split the training dataset so that we have a test dataset to check modeling results against
set.seed(121)
smp_size <- floor(0.80 * nrow(wine))
train_rows <- sample(seq_len(nrow(wine)), size = smp_size)
train <- wine[train_rows, ]
test <- wine[-train_rows, ]

pm <- glm(as.formula(paste(colnames(train)[1], "~", paste(colnames(train)[-1], collapse = "+"), sep = "")),data = train,family = poisson) 
summary(pm)

```
  
NEED VERBIAGE - DATA PREPARATION  
  

\begin{center}
{\huge Build Models}
\end{center}


##Build Models  

###Linear Regression Models  
  
```{r}
#start with basic linear regression model for each variable individually (baseline)
par(mfrow=c(2,3))
for (i in 2:v){
  plot(wine[,1] ~ wine[,i], xlab = f[i], ylab = f[1] )
  m <- glm(as.formula(paste(colnames(wine)[1], "~", paste(colnames(wine)[i], collapse = "+"), sep = "")),data = wine, family=poisson()) 
  abline(m,col="blue")
}

# create generalized linear model, poisson distribution.  this is for analyzing count data 
pm <- lm(as.formula(paste(colnames(train)[1], "~", paste(colnames(train)[-1], collapse = "+"), sep = "")),data = train) 
summary(pm)
```
  
NEED VERBIAGE - LINEAR MODELS  
  
###Regular Poisson Model  
  
```{r}

```
  
NEED VERBIAGE - REGULAR POISSION MODEL  
  
###Zero-inflated Poisson Model  
  
```{r,echo=FALSE}

# now build the model and run the AIC step function as usual
zp <- zeroinfl(formula=TARGET ~ ., data = wine, dist="poisson")
step(zp)

# Do a goodness-of-fit test
# Do a comparision with the regular poisson model !!!!!!!!!!

```
  
NEED VERBIAGE - ZERO_INFLATED POISSON MODEL  
  
###Regular Negative Binomial Model  
  
```{r,echo=FALSE}

```
  
NEED VERBIAGE - REGULAR NEGATIVE BINOMIAL MODEL  
  
###Zero-inflated Negative Regession Model  
  
```{r,echo=FALSE}

# now build the model and run the AIC step function as usual
zp <- zeroinfl(formula=TARGET ~ ., data = wine, dist="negbin")
step(zp)

# Do a goodness-of-fit test
# Do a comparision with the regular negative binomial model !!!!!!!!!!

```
  
NEED VERBIAGE - ZERO_INFLATED NEGATIVE BINOMIAL MODEL  
  

\begin{center}
{\huge Select Models}
\end{center}

##Select Models  
  
```{r,echo=FALSE}

```
  
NEED VERBIAGE - SELECT MODELS  
  
Smooth Operators - All Done!  
